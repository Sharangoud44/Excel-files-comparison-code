<!DOCTYPE html>
<html>
<head>
    <title>Excel Comparison Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body style="font-family: Arial; padding: 20px;">
    <h2>Excel Comparison Tool</h2>

    <input type="file" id="file1"><br><br>
    <input type="file" id="file2"><br><br>

    <button onclick="compareExcel()">Compare</button>

    <pre id="output" style="white-space: pre-wrap; background: #eee; padding: 15px; margin-top: 20px;"></pre>

    <script>

function readExcel(file, callback) {
    let reader = new FileReader();
    reader.onload = function (e) {
        let data = new Uint8Array(e.target.result);
        let workbook = XLSX.read(data, { type: "array" });
        let sheet = workbook.Sheets[workbook.SheetNames[0]];
        let json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        callback(json);
    };
    reader.readAsArrayBuffer(file);
}

function isNumberLike(value) {
    if (value === null || value === undefined) return false;
    if (typeof value === "number") return true;
    if (typeof value !== "string") return false;
    return /^[â‚¹$]?[0-9,\.%]+$/.test(value.trim());
}

function extractNumberFormat(value) {
    let v = value.toString().trim();

    return {
        hasComma: v.includes(","),
        hasCurrency: v.includes("â‚¹") || v.includes("$"),
        decimalPlaces: v.includes(".") ? v.split(".")[1].length : 0,
        isPercent: v.endsWith("%")
    };
}

function compareExcel() {
    let file1 = document.getElementById("file1").files[0];
    let file2 = document.getElementById("file2").files[0];

    if (!file1 || !file2) {
        alert("Please upload both Excel files");
        return;
    }

    readExcel(file1, function (excel1) {
        readExcel(file2, function (excel2) {

            let output = "";

            // -----------------------------------------
            // 1) COLUMN COUNT
            // -----------------------------------------
            let colCount1 = excel1[0].length;
            let colCount2 = excel2[0].length;

            output += `1) ðŸ“Œ Excel 1 Column Count: ${colCount1}\n`;
            output += `   ðŸ“Œ Excel 2 Column Count: ${colCount2}\n\n`;

            // -----------------------------------------
            // 2) COLUMN ORDER CHECK
            // -----------------------------------------
            let mismatchFound = false;

            for (let i = 0; i < Math.max(colCount1, colCount2); i++) {
                if (excel1[0][i] !== excel2[0][i]) {
                    mismatchFound = true;

                    output += `2) âŒ Column Order MISMATCHED\n`;
                    output += `   Excel 1: [Col-${i + 1}] ${excel1[0][i]}\n`;
                    output += `   Excel 2: [Col-${i + 1}] ${excel2[0][i]}\n\n`;
                    break;
                }
            }

            if (!mismatchFound) {
                output += `2) âœ”ï¸ Column Order: MATCHING\n\n`;
            }

            // -----------------------------------------
            // 3) ROW COUNT
            // -----------------------------------------
            let rowCount1 = excel1.length - 1;
            let rowCount2 = excel2.length - 1;

            output += `3) ðŸ“Œ Excel 1 Row Count: ${rowCount1}\n`;
            output += `   ðŸ“Œ Excel 2 Row Count: ${rowCount2}\n`;

            if (rowCount1 === rowCount2) {
                output += `   âœ”ï¸ Row Count: MATCHING\n\n`;
            } else {
                output += `   âŒ Row Count: NOT MATCHING\n\n`;
            }

            // -----------------------------------------
            // 4) NUMBER FORMAT CHECK (NEW)
            // -----------------------------------------
            output += `4) ðŸ” Number Format Check:\n`;

            let formatMismatchFound = false;

            for (let col = 0; col < excel1[0].length; col++) {

                let sample1 = excel1[1]?.[col];
                let sample2 = excel2[1]?.[col];

                if (!isNumberLike(sample1) || !isNumberLike(sample2)) continue;

                let f1 = extractNumberFormat(sample1);
                let f2 = extractNumberFormat(sample2);

                if (
                    f1.hasComma !== f2.hasComma ||
                    f1.hasCurrency !== f2.hasCurrency ||
                    f1.decimalPlaces !== f2.decimalPlaces ||
                    f1.isPercent !== f2.isPercent
                ) {
                    formatMismatchFound = true;

                    output += `   âŒ Column: ${excel1[0][col]}\n`;
                    output += `      Excel1 Example: ${sample1}\n`;
                    output += `      Excel2 Example: ${sample2}\n\n`;
                }
            }

            if (!formatMismatchFound) {
                output += `   âœ”ï¸ Number Formats: MATCHING\n\n`;
            }

            // -----------------------------------------
            // OUTPUT TO SCREEN
            // -----------------------------------------
            document.getElementById("output").textContent = output;
        });
    });
}

    </script>

</body>
</html>
