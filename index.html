<!DOCTYPE html>
<html>
<head>
    <title>Excel Comparison Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: Calibri, sans-serif;
            background: #f1f1f1;
            padding: 20px;
        }

        h2 {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* Excel-style section box */
        .excel-box {
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            padding: 15px 20px;
            margin-top: 20px;
            width: 98%;
        }

        /* Excel header style */
        .excel-header {
            background: #cfe2ff;
            padding: 8px 12px;
            border: 1px solid #99b7ff;
            font-weight: bold;
            width: 100%;
        }

        /* Each row style like Excel rows */
        .excel-row {
            padding: 8px 12px;
            border-left: 1px solid #d0d0d0;
            border-right: 1px solid #d0d0d0;
            border-bottom: 1px solid #e5e5e5;
            background: #fff;
        }

        .icon {
            font-size: 18px;
            margin-right: 6px;
        }

        /* Success and error colors */
        .ok { color: #008000; font-weight: bold; }
        .fail { color: #d40000; font-weight: bold; }

        button {
            padding: 8px 16px;
            background: #005eff;
            color: white;
            border: none;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
        }

        button:hover {
            background: #0046c7;
        }
    </style>
</head>

<body>

<h2>Excel Comparison Tool</h2>

<input type="file" id="file1" accept=".xlsx,.xls">
<input type="file" id="file2" accept=".xlsx,.xls">
<br><br>
<button onclick="compareExcel()">Compare</button>

<div id="result"></div>

<script>
function readExcel(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            resolve(XLSX.utils.sheet_to_json(sheet, { header: 1 }));
        };
        reader.readAsArrayBuffer(file);
    });
}

async function compareExcel() {
    const f1 = document.getElementById("file1").files[0];
    const f2 = document.getElementById("file2").files[0];

    if (!f1 || !f2) {
        alert("Please upload both Excel files.");
        return;
    }

    let d1 = await readExcel(f1);
    let d2 = await readExcel(f2);

    let col1 = d1[0];
    let col2 = d2[0];

    let rows1 = d1.length - 1;
    let rows2 = d2.length - 1;

    let html = "";

    // -------------------------------
    // 1) COLUMN COUNT
    // -------------------------------
    html += `
    <div class="excel-box">
        <div class="excel-header">1) Column Count</div>
        <div class="excel-row"><span class="icon">üìå</span>Excel 1 Column Count: ${col1.length}</div>
        <div class="excel-row"><span class="icon">üìå</span>Excel 2 Column Count: ${col2.length}</div>
    </div>
    `;

    // -------------------------------
    // 2) COLUMN ORDER
    // -------------------------------
    let mismatch1 = [];
    let mismatch2 = [];

    let max = Math.max(col1.length, col2.length);
    for (let i = 0; i < max; i++) {
        if (col1[i] !== col2[i]) {
            mismatch1.push(`[Col-${i + 1}] ${col1[i] || "(blank)"}`);
            mismatch2.push(`[Col-${i + 1}] ${col2[i] || "(blank)"}`);
        }
    }

    html += `
    <div class="excel-box">
        <div class="excel-header">2) Column Order</div>
    `;

    if (mismatch1.length === 0) {
        html += `<div class="excel-row ok"><span class="icon">‚úîÔ∏è</span>Column Order: MATCHING</div>`;
    } else {
        html += `
            <div class="excel-row fail"><span class="icon">‚ùå</span>Column Order MISMATCHED</div>
            <div class="excel-row">Excel 1: ${mismatch1.join(", ")}</div>
            <div class="excel-row">Excel 2: ${mismatch2.join(", ")}</div>
        `;
    }

    html += `</div>`;

    // -------------------------------
    // 3) ROW COUNT
    // -------------------------------
    html += `
    <div class="excel-box">
        <div class="excel-header">3) Row Count</div>
        <div class="excel-row">Excel 1 Row Count: ${rows1}</div>
        <div class="excel-row">Excel 2 Row Count: ${rows2}</div>
    `;

    if (rows1 === rows2) {
        html += `<div class="excel-row ok"><span class="icon">‚úîÔ∏è</span>Row Count: MATCHING</div>`;
    } else {
        html += `<div class="excel-row fail"><span class="icon">‚ùå</span>Row Count: NOT MATCHING</div>`;
    }

    html += `</div>`;

    // -------------------------------
    // 4) NUMBER FORMAT CHECK
    // -------------------------------
    function detectFormat(val) {
        if (typeof val !== "string") val = String(val);

        return {
            hasComma: val.includes(","),
            decimals: val.includes(".") ? val.split(".")[1].length : 0,
            hasCurrency: /[$‚Çπ‚Ç¨¬£]/.test(val)
        };
    }

    let formatMismatch = [];
    for (let i = 1; i < d1.length; i++) {
        for (let j = 0; j < col1.length; j++) {
            let v1 = d1[i][j];
            let v2 = d2[i] ? d2[i][j] : null;

            if (!isNaN(v1) && !isNaN(v2)) {
                let f1 = detectFormat(v1);
                let f2 = detectFormat(v2);

                if (JSON.stringify(f1) !== JSON.stringify(f2)) {
                    formatMismatch.push({
                        col: col1[j],
                        v1, v2
                    });
                    break;
                }
            }
        }
    }

    html += `
    <div class="excel-box">
        <div class="excel-header">4) Number Format Check</div>
    `;

    if (formatMismatch.length === 0) {
        html += `<div class="excel-row ok"><span class="icon">‚úîÔ∏è</span>Number Formats: MATCHING</div>`;
    } else {
        html += `<div class="excel-row fail"><span class="icon">‚ùå</span>Number Format Differences Found:</div>`;
        formatMismatch.forEach(x => {
            html += `
                <div class="excel-row">
                    <b>${x.col}</b> ‚Üí Excel1: ${x.v1} | Excel2: ${x.v2}
                </div>`;
        });
    }

    html += `</div>`;

    document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>
