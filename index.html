<!DOCTYPE html>
<html>
<head>
    <title>Excel Compare Tool â€“ Excel Green</title>

    <!-- XLSX LIB -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: Calibri, Arial, sans-serif;
            background: #f2f8f2;
            margin: 0;
            padding: 20px;
        }

        h2 {
            background: #1f6e43;
            padding: 12px;
            color: white;
            border-radius: 6px;
            width: fit-content;
        }

        .box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 6px solid #1f6e43;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
            width: 600px;
        }

        .section-title {
            background: #1f6e43;
            color: white;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        button {
            background: #1f6e43;
            color: white;
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            margin-top: 5px;
        }
        button:hover { background: #145c35; }

        .partition {
            background: #e8f5e9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #b7d8c5;
            margin-top: 10px;
        }

        .mismatch { color: red; font-weight: bold; }
        .match { color: green; font-weight: bold; }

        pre {
            white-space: pre-wrap;
            font-family: Consolas, monospace;
            background: #fff;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>

<body>

<h2>Excel Compare â€” Excel Green</h2>

<div class="box">
    <label><b>Upload Excel 1:</b></label><br>
    <input type="file" id="file1" accept=".xlsx,.xls"><br><br>

    <label><b>Upload Excel 2:</b></label><br>
    <input type="file" id="file2" accept=".xlsx,.xls"><br><br>

    <button onclick="compareExcel()">Compare Now</button>
</div>

<div class="box">
    <div class="section-title">Comparison Output</div>
    <pre id="output">Upload files and click Compare.</pre>
</div>

<script>
function readExcel(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            resolve(XLSX.utils.sheet_to_json(sheet, { header: 1 }));
        };
        reader.readAsArrayBuffer(file);
    });
}

async function compareExcel() {

    const f1 = document.getElementById("file1").files[0];
    const f2 = document.getElementById("file2").files[0];

    if (!f1 || !f2) {
        alert("Please upload both files!");
        return;
    }

    let d1 = await readExcel(f1);
    let d2 = await readExcel(f2);

    // ðŸ”¥ ALWAYS take row-1 as column headers
    let col1 = d1[0] || [];
    let col2 = d2[0] || [];

    let rows1 = d1.length - 1;
    let rows2 = d2.length - 1;

    let out = "";

    // ================================
    // 1) COLUMN COUNT
    // ================================
    out += "1) Column Count\n";
    out += "ðŸ“Œ Excel 1 Column Count: " + col1.length + "\n";
    out += "ðŸ“Œ Excel 2 Column Count: " + col2.length + "\n";
    out += "--------------------------------------------\n\n";

    // ================================
    // 2) COLUMN ORDER
    // ================================
    out += "2) Column Order\n";

    let mismatches = [];
    let max = Math.max(col1.length, col2.length);

    for (let i = 0; i < max; i++) {
        if ((col1[i] || "").trim() !== (col2[i] || "").trim()) {
            mismatches.push(
                `[Col-${i+1}] Excel1 â†’ ${col1[i] || "(blank)"} | Excel2 â†’ ${col2[i] || "(blank)"}`
            );
        }
    }

    if (mismatches.length === 0) {
        out += "âœ” Column Order MATCHING\n\n";
    } else {
        out += "âŒ Column Order MISMATCHED\n";
        out += mismatches.join("\n") + "\n\n";
    }

    out += "--------------------------------------------\n\n";

    // ================================
    // 3) ROW COUNT
    // ================================
    out += "3) Row Count\n";
    out += `ðŸ“Œ Excel 1 Row Count: ${rows1}\n`;
    out += `ðŸ“Œ Excel 2 Row Count: ${rows2}\n`;

    if (rows1 === rows2) {
        out += "âœ” Row Count MATCHING\n\n";
    } else {
        out += "âŒ Row Count NOT MATCHING\n\n";
    }

    out += "--------------------------------------------\n\n";

    // ================================
    // 4) NUMBER FORMAT CHECK
    // ================================
    out += "4) Number Format Check\n";

    let numberIssues = [];

    for (let i = 0; i < col1.length; i++) {
        let v1 = d1[1]?.[i];
        let v2 = d2[1]?.[i];

        let isNum1 = !isNaN(parseFloat(v1));
        let isNum2 = !isNaN(parseFloat(v2));

        if (isNum1 !== isNum2) {
            numberIssues.push(
                `[Col-${i+1}] Number Format Difference â†’ Excel1: ${v1} | Excel2: ${v2}`
            );
        }
    }

    if (numberIssues.length === 0) {
        out += "âœ” Number formats matching\n";
    } else {
        out += "âŒ Number format mismatches found:\n";
        out += numberIssues.join("\n") + "\n";
    }

    document.getElementById("output").textContent = out;
}
</script>

</body>
</html>
