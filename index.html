<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Excel Compare — Excel Green</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Calibri,Arial;background:#f2f8f2;padding:24px}
h1{background:#1f6e43;color:#fff;padding:12px 18px;border-radius:6px;width:fit-content}
.box{background:#fff;border-left:6px solid #1f6e43;border-radius:8px;padding:16px;margin:20px 0;
     box-shadow:0 0 8px rgba(0,0,0,.1);max-width:900px}
button{background:#1f6e43;color:#fff;border:none;border-radius:5px;padding:9px 16px;font-size:15px;cursor:pointer}
button:hover{background:#145c35}
pre{white-space:pre-wrap;font-family:Consolas;background:#fff;border:1px solid #cde2cc;
     padding:12px;border-radius:6px;max-width:900px}
</style>
</head>

<body>

<h1>Excel Compare — Excel Green 2222</h1>

<div class="box">
  <b>Upload Excel 1:</b><br>
  <input type="file" id="file1" accept=".xlsx,.xls"><br><br>

  <b>Upload Excel 2:</b><br>
  <input type="file" id="file2" accept=".xlsx,.xls"><br><br>

  <button onclick="compareExcels()">Compare Now</button>
</div>

<pre id="out">Upload two Excel files and click Compare Now.</pre>

<script>
// Read Excel
async function readFile(file){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload=e=>{
      try{
        const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
        resolve(wb);
      }catch(err){reject(err);}
    };
    reader.readAsArrayBuffer(file);
  });
}

// Always take row-1 as header (100% reliable)
function getHeaders(sheet){
  const arr=XLSX.utils.sheet_to_json(sheet,{header:1}); 
  let hdr=arr[0] || [];

  // CLEAN headers: convert everything to string
  hdr = hdr.map(h => (h==null ? "" : String(h).trim()));

  return hdr;
}

// Count rows after header
function getRowCount(sheet){
  const arr=XLSX.utils.sheet_to_json(sheet,{header:1});
  return arr.length - 1; 
}

async function compareExcels(){
  const f1=document.getElementById("file1").files[0];
  const f2=document.getElementById("file2").files[0];
  const out=document.getElementById("out");

  if(!f1 || !f2){
    out.textContent="Please upload both Excel files.";
    return;
  }

  out.textContent="Processing...";

  try{
    const wb1=await readFile(f1);
    const wb2=await readFile(f2);

    const s1=wb1.Sheets[wb1.SheetNames[0]];
    const s2=wb2.Sheets[wb2.SheetNames[0]];

    const h1=getHeaders(s1);
    const h2=getHeaders(s2);

    const r1=getRowCount(s1);
    const r2=getRowCount(s2);

    let txt="";

    // Column Count
    txt += `1) Column Count\nExcel1: ${h1.length}\nExcel2: ${h2.length}\n\n`;

    // Column Order
    txt += `2) Column Order\n`;
    let diff=[];

    const max=Math.max(h1.length,h2.length);
    for(let i=0;i<max;i++){
      if((h1[i]||"") !== (h2[i]||"")){
        diff.push(`[Col-${i+1}] Excel1 → ${h1[i]||"(blank)"} | Excel2 → ${h2[i]||"(blank)"}`);
      }
    }

    if(diff.length===0) txt+="✔ MATCHED\n\n";
    else txt+="❌ MISMATCHED\n"+diff.join("\n")+"\n\n";

    // Row Count
    txt += `3) Row Count\nExcel1: ${r1}\nExcel2: ${r2}\n`;
    txt += (r1===r2 ? "✔ MATCH\n" : "❌ NOT MATCH\n");

    out.textContent = txt;

  }catch(err){
    out.textContent="Error: "+err.message;
    console.error(err);
  }
}
</script>

</body>
</html>
