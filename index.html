<!DOCTYPE html>
<html>
<head>
    <title>Excel Compare Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<h2>Compare Two Excel Files</h2>

<label>Upload File 1:</label>
<input type="file" id="file1" accept=".xlsx,.xls"><br><br>

<label>Upload File 2:</label>
<input type="file" id="file2" accept=".xlsx,.xls"><br><br>

<button onclick="compareExcel()">Compare Now</button>

<h3>Differences:</h3>
<pre id="output" style="white-space: pre-wrap; background: #eee; padding: 10px;"></pre>

<script>
function readExcel(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            resolve(XLSX.utils.sheet_to_json(sheet, { header: 1 })); // returns rows as arrays
        };
        reader.readAsArrayBuffer(file);
    });
}

async function compareFiles() {
    const file1 = document.getElementById("file1").files[0];
    const file2 = document.getElementById("file2").files[0];

    if (!file1 || !file2) {
        alert("Please upload both files!");
        return;
    }

    let data1 = await readExcel(file1);
    let data2 = await readExcel(file2);

    let columns1 = data1[0];
    let columns2 = data2[0];

    let output = "";

    // -------------------------
    // 1. COLUMN ORDER CHECK
    // -------------------------
    if (JSON.stringify(columns1) === JSON.stringify(columns2)) {
        output += "<b>Column Order:</b> Matching ✔️<br><br>";
    } else {
        output += "<b>Column Order:</b> NOT Matching ❌<br>";
        output += "<b>Mismatched Columns:</b><br><pre>";

        let maxLength = Math.max(columns1.length, columns2.length);

        for (let i = 0; i < maxLength; i++) {
            if (columns1[i] !== columns2[i]) {
                output += `Position ${i + 1}:  
File1 → ${columns1[i] || "(blank)"}  
File2 → ${columns2[i] || "(blank)"}\n\n`;
            }
        }
        output += "</pre>";
    }

    // -------------------------
    // 2. ROW COUNT CHECK
    // -------------------------
    let rows1 = data1.length - 1; 
    let rows2 = data2.length - 1;

    if (rows1 === rows2) {
        output += "<b>Row Count:</b> Matching ✔️<br>";
    } else {
        output += "<b>Row Count:</b> NOT Matching ❌<br>";
        output += `File1 Rows: ${rows1}<br>`;
        output += `File2 Rows: ${rows2}<br>`;
    }

    document.getElementById("output").innerHTML = output;
}
</script>


</body>
</html>
