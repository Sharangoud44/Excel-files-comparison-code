<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excel Compare — Excel Green</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body { font-family: Calibri, Arial; background:#eef8ee; padding:25px; }
h1  { background:#1f6e43; color:white; padding:12px 20px; border-radius:6px; width:fit-content; }

.box{
  background:white; border-left:6px solid #1f6e43;
  padding:18px; margin-top:20px; border-radius:8px;
  max-width:900px; box-shadow:0 0 8px rgba(0,0,0,.1);
}

button{
  background:#1f6e43; color:white; padding:10px 18px;
  border:none; border-radius:6px; cursor:pointer; font-size:16px;
}
button:hover{ background:#145c35; }

pre{
  background:white; padding:15px; border-radius:8px;
  border:1px solid #cfe6cf; max-width:900px; font-size:15px;
  white-space:pre-wrap; font-family:Consolas,monospace;
}

.success{ color:#0a7d34; font-weight:bold; }
.error  { color:#c80000; font-weight:bold; }
</style>
</head>

<body>

<h1>Excel Compare — Excel Green 777777</h1>

<div class="box">
  <b>Upload Excel 1:</b><br>
  <input type="file" id="file1" accept=".xlsx,.xls"><br><br>

  <b>Upload Excel 2:</b><br>
  <input type="file" id="file2" accept=".xlsx,.xls"><br><br>

  <button onclick="compareExcels()">Compare Now</button>
</div>

<pre id="out">Upload two Excel files and click Compare Now.</pre>


<script>
/* ALWAYS USE FIRST ROW AS HEADER — FIXES SPLASHBI ISSUE 100% */
function parseExcel(file){
  return new Promise((resolve, reject)=>{
    const reader = new FileReader();

    reader.onload = e => {
      try{
        const data = new Uint8Array(e.target.result);
        const wb = XLSX.read(data, {type:"array"});

        const sheet = wb.Sheets[wb.SheetNames[0]];
        const arr   = XLSX.utils.sheet_to_json(sheet, {header:1});

        const headers = (arr[0] || []).map(h => String(h||"").trim());
        const rows    = arr.length - 1;

        resolve({ headers, rows });
      }
      catch(err){ reject(err); }
    };

    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}



async function compareExcels(){
  const f1 = document.getElementById("file1").files[0];
  const f2 = document.getElementById("file2").files[0];
  const out= document.getElementById("out");

  if(!f1 || !f2){
    alert("Upload both Excel files.");
    return;
  }

  out.textContent = "Processing...";

  try{
    const ex1 = await parseExcel(f1);
    const ex2 = await parseExcel(f2);

    let text = "";

    // 1) Column count
    text += `1) Column Count\nExcel 1: ${ex1.headers.length}\nExcel 2: ${ex2.headers.length}\n\n`;

    // 2) Column order
    const max = Math.max(ex1.headers.length, ex2.headers.length);
    const diffs = [];

    for(let i=0; i<max; i++){
      const a = ex1.headers[i] || "(blank)";
      const b = ex2.headers[i] || "(blank)";
      if(a !== b){
        diffs.push(`[Col-${i+1}] Excel1 → ${a} | Excel2 → ${b}`);
      }
    }

    if(diffs.length === 0){
      text += "2) ✔ Column Order MATCHED\n\n";
    } else {
      text += "2) ❌ Column Order MISMATCHED\n" + diffs.join("\n") + "\n\n";
    }

    // 3) Row count
    text += `3) Row Count\nExcel 1: ${ex1.rows}\nExcel 2: ${ex2.rows}\n`;
    text += (ex1.rows === ex2.rows ? "✔ Rows MATCH\n" : "❌ Rows NOT MATCH\n");

    out.textContent = text;
  }
  catch(err){
    out.textContent = "Error: " + err;
    console.error(err);
  }
}
</script>

</body>
</html>
