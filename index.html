<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Excel Compare — Excel Green 11111</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body{font-family:Calibri,Arial,sans-serif;background:#f2f8f2;margin:0;padding:24px;}
h1{background:#1f6e43;color:#fff;padding:12px 18px;border-radius:6px;width:fit-content}
.box{background:#fff;border-left:6px solid #1f6e43;border-radius:8px;padding:16px;margin:20px 0;
     box-shadow:0 0 8px rgba(0,0,0,.1);max-width:900px}
button{background:#1f6e43;color:#fff;border:none;border-radius:5px;padding:9px 16px;font-size:15px;cursor:pointer}
button:hover{background:#145c35}
pre{white-space:pre-wrap;font-family:Consolas,monospace;background:#fff;border:1px solid #cde2cc;
     padding:12px;border-radius:6px;max-width:900px}
.success{color:#0a7d34;font-weight:700}.error{color:#c80000;font-weight:700}
.table{border-collapse:collapse;width:100%;margin-top:8px}
.table th,.table td{border:1px solid #cde2cc;padding:6px 8px}
.table th{background:#e2efd9;color:#1f6e43}
</style>
</head>
<body>

<h1>Excel Compare — Excel Green11111</h1>

<div class="box">
  <b>Upload Excel 1:</b><br>
  <input type="file" id="file1" accept=".xlsx,.xls"><br><br>
  <b>Upload Excel 2:</b><br>
  <input type="file" id="file2" accept=".xlsx,.xls"><br><br>
  <button onclick="compareExcels()">Compare Now</button>
</div>

<pre id="out">Upload two Excel files and click Compare Now.</pre>

<script>
async function readWorkbook(file){
  return new Promise((res,rej)=>{
    const r=new FileReader();
    r.onload=e=>{
      try{
        const data=new Uint8Array(e.target.result);
        const wb=XLSX.read(data,{type:"array"});
        res(wb);
      }catch(err){rej(err);}
    };
    r.onerror=rej;
    r.readAsArrayBuffer(file);
  });
}

// detect SplashBI / Express / Normal
function detectHeaderRow(sheetArr){
  const r1=sheetArr[0]||[],r2=sheetArr[1]||[];
  const splash=r1.every(c=>/^C\d{2}$/i.test(c||""));
  if(splash) return 1; // real header is row2 (index1)
  return 0;            // otherwise first row
}

async function parseExcel(file){
  const wb=await readWorkbook(file);
  const names=wb.SheetNames;
  // identify SplashBI or Express by LAST sheet text
  const lastSheet=wb.Sheets[names[names.length-1]];
  const lastCell=(lastSheet["A1"]?.v||"").toString().toLowerCase();
  let source="Normal";
  if(lastCell.includes("splashbi")) source="SplashBI";
  else if(lastCell.includes("express")) source="Express";

  // choose first sheet for data
  const sheet=wb.Sheets[names[0]];
  const arr=XLSX.utils.sheet_to_json(sheet,{header:1});
  const headerIndex=detectHeaderRow(arr);
  const headers=arr[headerIndex];
  const rows=arr.length-(headerIndex+1);
  return {source,headers,rows};
}

async function compareExcels(){
  const f1=document.getElementById("file1").files[0];
  const f2=document.getElementById("file2").files[0];
  const out=document.getElementById("out");
  out.textContent="Processing...";
  if(!f1||!f2){alert("Please upload both files");return;}

  try{
    const [ex1,ex2]=await Promise.all([parseExcel(f1),parseExcel(f2)]);
    let txt=`Excel 1 Source: ${ex1.source}\nExcel 2 Source: ${ex2.source}\n\n`;

    // 1️⃣ Column count
    txt+=`1) Column Count\nExcel 1: ${ex1.headers.length}\nExcel 2: ${ex2.headers.length}\n\n`;

    // 2️⃣ Column order
    const max=Math.max(ex1.headers.length,ex2.headers.length);
    const diffs=[];
    for(let i=0;i<max;i++){
      const a=(ex1.headers[i]||"").trim(),b=(ex2.headers[i]||"").trim();
      if(a!==b) diffs.push(`[Col-${i+1}] Excel1 → ${a||"(blank)"} | Excel2 → ${b||"(blank)"}`);
    }
    if(diffs.length===0) txt+="2) ✔ Column Order MATCHED\n\n";
    else txt+="2) ❌ Column Order MISMATCHED\n"+diffs.join("\n")+"\n\n";

    // 3️⃣ Row count
    txt+=`3) Row Count\nExcel 1: ${ex1.rows}\nExcel 2: ${ex2.rows}\n`;
    txt+=(ex1.rows===ex2.rows?"✔ Rows MATCH\n\n":"❌ Rows NOT MATCH\n\n");

    out.textContent=txt;
  }catch(err){
    out.textContent="Error: "+err;
    console.error(err);
  }
}
</script>
</body>
</html>
