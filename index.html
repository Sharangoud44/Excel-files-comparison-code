<!DOCTYPE html>
<html>
<head>
    <title>Excel Compare Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<h2>Compare Two Excel Files</h2>

<label>Upload File 1:</label>
<input type="file" id="file1" accept=".xlsx,.xls"><br><br>

<label>Upload File 2:</label>
<input type="file" id="file2" accept=".xlsx,.xls"><br><br>

<button onclick="compareExcel()">Compare Now</button>

<h3>Differences:</h3>
<pre id="output" style="white-space: pre-wrap; background: #eee; padding: 10px;"></pre>

<script>
function readExcel(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            resolve(XLSX.utils.sheet_to_json(sheet, { header: 1 }));
        };
        reader.readAsArrayBuffer(file);
    });
}

async function compareFiles() {
    const f1 = document.getElementById("file1").files[0];
    const f2 = document.getElementById("file2").files[0];

    if (!f1 || !f2) {
        alert("Upload both files!");
        return;
    }

    let d1 = await readExcel(f1);
    let d2 = await readExcel(f2);

    let col1 = d1[0];
    let col2 = d2[0];

    let rows1 = d1.length - 1;
    let rows2 = d2.length - 1;

    let output = "";

    // ---------------------------
    // 1️⃣ COLUMN COUNT
    // ---------------------------
    output += `<b>Excel1 Columns:</b> ${col1.length}<br>`;
    output += `<b>Excel2 Columns:</b> ${col2.length}<br><br>`;

    // ---------------------------
    // 2️⃣ COLUMN ORDER CHECK
    // ---------------------------
    let mismatchList1 = [];
    let mismatchList2 = [];

    let max = Math.max(col1.length, col2.length);
    for (let i = 0; i < max; i++) {
        if (col1[i] !== col2[i]) {
            mismatchList1.push(`[Col-${i + 1}] ${col1[i] || "(blank)"}`);
            mismatchList2.push(`[Col-${i + 1}] ${col2[i] || "(blank)"}`);
        }
    }

    if (mismatchList1.length === 0) {
        output += `<b>Column Order:</b> MATCHING ✔️<br><br>`;
    } else {
        output += `<b>Column Order:</b> MISMATCH ❌<br>`;
        output += `<b>Excel1 →</b> ${mismatchList1.join(", ")}<br>`;
        output += `<b>Excel2 →</b> ${mismatchList2.join(", ")}<br><br>`;
    }

    // ---------------------------
    // 3️⃣ ROW COUNT CHECK
    // ---------------------------
    output += `<b>Excel1 Rows:</b> ${rows1}<br>`;
    output += `<b>Excel2 Rows:</b> ${rows2}<br>`;

    if (rows1 === rows2) {
        output += `<b>Row Count:</b> MATCHING ✔️<br>`;
    } else {
        output += `<b>Row Count:</b> NOT MATCHING ❌<br>`;
    }

    document.getElementById("output").innerHTML = output;
}
</script>



</body>
</html>
